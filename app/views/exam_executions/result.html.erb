<%= title 'Resultados', 
  link_to('Salvar', '#', :id => 'save_button_exam_execution'),
  link_to('Voltar', 
    exam_executions_path(
      if @exam_execution.is_bolsao
        {filter_by: 'is_bolsao'}
      elsif ProductYear.school_products.include?(@exam_execution.super_klazz.product_year)
        {filter_by: 'school'}
      elsif ProductYear.free_course_products.include?(@exam_execution.super_klazz.product_year)
        {filter_by: 'free_course'}
      end
    )
  )
%>

<h2 class="klazz_name_exam_execution"><%= @exam_execution.exam_cycle.name + ' • ' + @exam_execution.super_klazz.campus.name + ' • ' + @exam_execution.datetime.strftime('%d/%m/%Y') %></h2>
<% if @has_errors %>
  <p class="alert-error">Alguns alunos não constam no resultado abaixo por erro de marcação.</p>
  <p class="alert-error">Aguarde o Setor de Resultados terminar a resolução de pendências para retirar o resultado completo. </p>
<% end %>

<table id="results" class="display is-one-page-datatable">
  <thead>
    <tr>
      <th>RA</th>
      <th>Nome</th>
      <th>Unidade</th>
      <% @subjects.each do |subject| %>
        <th><%= subject.code.capitalize %></th>
      <% end %>
      <th>Total</th>
   </tr>
  </thead>

  <tbody>
  <% @results.each do |result| %>
    <tr>
      <td><%= "%06d" % result['RA'].to_i %></td>
      <td><%= result['NAME'].split(' ').map(&:capitalize).join(' ') %>
        <span style='float: right;'>
          <%= result['LINK'] %>
        </span>
      </td>
      <td><%= result['CAMPUS'] %></td>
      <% sum = 0 %>
      <% @subjects.each do |subject| %>
        <td><%= grade = result[subject.code] %><% sum += grade %></td>
      <% end %>
      <td><%= sum %></td>
    </tr>
  <% end %>
  </tbody>
</table>